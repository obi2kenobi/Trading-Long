//@version=6
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// @title        TEMA-ST-WT LONG OPTIMIZED ADVANCED
// @description  Versione con bug fix critici, ATR multi-timeframe, e filtri corretti
// @version      6.4
// @author       Trading-Long Strategy
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// ğŸ”§ BUG FIX v6.4 - CODE REVIEW & OPTIMIZATION:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âœ“ ğŸ› FIX Filter Scoring - Filtri disabilitati non gonfiano piÃ¹ il punteggio
// âœ“ ğŸ› FIX TP1/TP2 Stop Loss - Tutte le porzioni della posizione ora protette
// âœ“ ğŸ› FIX ATR Timeframe - ATR calcolato sul timeframe strategy, non chart
// âœ“ ğŸ› FIX Gap Detection - Usa dati multi-timeframe corretti (open_tf)
// âœ“ ğŸ§¹ Rimosso codice morto (entryPriceWithSlippage, entrySlippage)
// âœ“ âš¡ TEMA ottimizzato - EMA intermedie cachate (no ricalcolo ridondante)
// âœ“ âš™ï¸ Soglia bassa volatilitÃ  ora configurabile (lowVolThreshold)
//
// ğŸš€ MIGLIORAMENTI v6.2 - GRAFICA ULTRA LEGGIBILE:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âœ“ ğŸ§¹ CLEAN VIEW MODE - ModalitÃ  grafico pulito con un click
// âœ“ Labels Compatti - Meno testo, piÃ¹ leggibilitÃ 
// âœ“ Dimensione Segnali Configurabile - Da tiny a huge
// âœ“ Background Opzionale - Non piÃ¹ sempre visibile
// âœ“ Warning Signals Opzionali - G/R nascosti di default
// âœ“ Livelli SL/TP piÃ¹ sottili - Non coprono piÃ¹ le candele
// âœ“ Dashboard Rispetta Clean Mode
//
// ğŸ“Š FUNZIONALITÃ€ BASE (da v6.0/6.1):
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âœ“ SISTEMA FILTRI FLESSIBILE - Scoring system configurabile (default: 2/4)
// âœ“ Filtro RSI - Evita entrate in zone di ipercomprato (default: RSI < 75)
// âœ“ Filtro Volume - Richiede volume >= media (default: 1.0x, protezione volume)
// âœ“ ADX Trend Strength - Evita mercati choppy (default: ADX > 20)
// âœ“ Gap Detection - Rileva gap significativi (default: > 0.8%)
// âœ“ Filtri ON/OFF Individuali - Ogni filtro puÃ² essere abilitato/disabilitato
// âœ“ Volatility Regime - Identifica alta/bassa volatilitÃ  per adattamento
// âœ“ ğŸ”¥ TRAILING STOP - Break-even automatico al +3.5% (configurabile)
// âœ“ Stop Loss Intelligente - Fisso % o ATR-based (dinamico su volatilitÃ )
// âœ“ Risk Management Avanzato - SL/TP completamente configurabili
// âœ“ Dashboard Dinamica - Mostra trailing status, filtri, e metriche real-time
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â€” INPUT TIMEFRAME â€”
tf = input.string("120", "Timeframe", options = ["120","240"])

// â€” DATI MULTITF (inclusi ATR per coerenza timeframe) â€”
[close_tf, high_tf, low_tf, open_tf, hl2_tf, hlc3_tf, vol_tf, atr10_tf, atr14_tf] = request.security(syminfo.tickerid, tf, [close, high, low, open, hl2, hlc3, volume, ta.atr(10), ta.atr(14)])

// â€” STRATEGY SETTINGS â€”
strategy("TEMA-ST-WT LONG v6.4 ADV", overlay=true,
     initial_capital    = 100000,
     default_qty_type   = strategy.percent_of_equity,
     default_qty_value  = 100,
     pyramiding         = 0,
     commission_type    = strategy.commission.percent,
     commission_value   = 0.01)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARAMETRI OTTIMIZZATI (valori finali dall'ottimizzazione)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

temaLen_in   = 36
stFactor_in  = 2.6
maxDistATR   = 2.2
stFactor_out = 3.4
temaLen_out  = 38
wtN2_in      = 15

stPeriod_in  = 10
wtN1_in      = 10
stPeriod_out = 10
wtN1_out     = 10
wtN2_out     = 21

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NUOVI FILTRI AVANZATI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Sistema Filtri Intelligente
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
useAdvancedFilters = input.bool(true, "ğŸ”§ Abilita Filtri Avanzati", group="Advanced Filters")
minFiltersRequired = input.int(2, "Filtri Minimi Richiesti (su 4)", minval=0, maxval=4, group="Advanced Filters", tooltip="0=Nessun filtro, 2=Bilanciato, 4=Molto restrittivo")

// RSI Settings
enableRSI    = input.bool(true, "Abilita Filtro RSI", group="RSI Filter")
rsiLen       = input.int(14, "RSI Period", minval=5, maxval=30, group="RSI Filter")
rsiOverbought = input.int(75, "RSI Overbought Level", minval=60, maxval=90, group="RSI Filter")

// Volume Settings
enableVolume = input.bool(true, "Abilita Filtro Volume", group="Volume Filter")
volMaLen     = input.int(20, "Volume MA Period", minval=10, maxval=50, group="Volume Filter")
volMultiplier = input.float(1.0, "Volume Multiplier", minval=0.5, maxval=3.0, step=0.1, group="Volume Filter")

// ADX Settings (Anti-Choppy)
enableADX    = input.bool(true, "Abilita Filtro ADX", group="ADX Filter")
adxLen       = input.int(14, "ADX Period", minval=7, maxval=30, group="ADX Filter")
adxThreshold = input.float(20.0, "ADX Minimum (Trend Strength)", minval=15.0, maxval=40.0, step=1.0, group="ADX Filter")

// Gap Detection
enableGapFilter = input.bool(true, "Abilita Filtro Gap", group="Gap Filter")
gapThreshold = input.float(0.8, "Gap Threshold %", minval=0.2, maxval=2.0, step=0.1, group="Gap Filter") / 100

// Volatility Regime
atrMaLen     = input.int(50, "ATR MA Period", minval=20, maxval=100, group="Volatility")
highVolMultiplier = input.float(1.5, "High Volatility Threshold", minval=1.2, maxval=2.5, step=0.1, group="Volatility")
lowVolThreshold = input.float(0.7, "Low Volatility Threshold", minval=0.3, maxval=1.0, step=0.1, group="Volatility")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Risk Management - Stop Loss & Trailing
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Slippage
slippagePerc = input.float(0.05, "Slippage Assumption %", minval=0.01, maxval=0.5, step=0.01, group="Risk Management") / 100

// Stop Loss Type - PIÃ™ STRETTO
useFixedStopLoss = input.bool(true, "Usa Stop Loss Fisso", group="Risk Management")
fixedStopPerc = input.float(1.5, "Stop Loss %", minval=0.5, maxval=5.0, step=0.1, group="Risk Management") / 100

useATRStopLoss = input.bool(false, "Usa Stop Loss Basato su ATR", group="Risk Management")
atrStopMultiplier = input.float(1.5, "ATR Stop Multiplier", minval=1.0, maxval=3.0, step=0.1, group="Risk Management")

// Trailing Stop
enableTrailing = input.bool(true, "ğŸ”¥ Abilita Trailing Stop", group="Risk Management")
trailingActivationPerc = input.float(2.5, "Trailing Activation %", minval=1.0, maxval=10.0, step=0.5, group="Risk Management", tooltip="Quando il profit raggiunge questa %, attiva trailing") / 100
trailingOffsetPerc = input.float(0.5, "Trailing Offset %", minval=0.0, maxval=3.0, step=0.1, group="Risk Management", tooltip="0% = Break-Even, >0% = protegge parte del profitto") / 100

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Take Profit a 3 LIVELLI con Alleggerimenti
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
useTakeProfit = input.bool(true, "Usa Take Profit Multi-Livello", group="Take Profit 3 Livelli")

// TP1 - Primo alleggerimento
tp1Perc = input.float(2.5, "TP1 - Primo Target %", minval=1.0, maxval=10.0, step=0.5, group="Take Profit 3 Livelli") / 100
tp1Qty = input.float(30.0, "TP1 - % Posizione da Chiudere", minval=10.0, maxval=50.0, step=5.0, group="Take Profit 3 Livelli")

// TP2 - Secondo alleggerimento
tp2Perc = input.float(5.0, "TP2 - Secondo Target %", minval=2.0, maxval=15.0, step=0.5, group="Take Profit 3 Livelli") / 100
tp2Qty = input.float(30.0, "TP2 - % Posizione da Chiudere", minval=10.0, maxval=50.0, step=5.0, group="Take Profit 3 Livelli")

// TP3 - Chiusura finale
tp3Perc = input.float(8.0, "TP3 - Target Finale %", minval=3.0, maxval=20.0, step=0.5, group="Take Profit 3 Livelli") / 100

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Opzioni Visualizzazione - CHART READABILITY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cleanViewMode = input.bool(false, "ğŸ§¹ CLEAN VIEW MODE (Grafico Pulito)", group="ğŸ“Š Chart Display", tooltip="Attiva per nascondere la maggior parte degli elementi e avere un grafico piÃ¹ pulito")
showLabels   = input.bool(true, "Mostra labels trade", group="ğŸ“Š Chart Display")
compactLabels = input.bool(true, "Labels compatti (meno info)", group="ğŸ“Š Chart Display", tooltip="Labels piÃ¹ piccoli con solo le info essenziali")
showDashboard = input.bool(true, "Mostra dashboard", group="ğŸ“Š Chart Display")
showLevels   = input.bool(true, "Mostra livelli SL/TP", group="ğŸ“Š Chart Display")
showFilters  = input.bool(true, "Mostra stato filtri in dashboard", group="ğŸ“Š Chart Display")
showWarnings = input.bool(false, "Mostra warning signals (G/R)", group="ğŸ“Š Chart Display", tooltip="Mostra indicatori Gap e RSI sul grafico")
showBackground = input.bool(false, "Mostra background volatilitÃ ", group="ğŸ“Š Chart Display", tooltip="Colora sfondo in base alla volatilitÃ ")
labelSize    = input.string("small", "Dimensione labels", options=["tiny", "small", "normal", "large"], group="ğŸ“Š Chart Display")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// TEMA IN (EMA intermedie cachate per efficienza)
ema1_in  = ta.ema(close_tf, temaLen_in)
ema2_in  = ta.ema(ema1_in, temaLen_in)
ema3_in  = ta.ema(ema2_in, temaLen_in)
tema_in  = 3 * ema1_in - 3 * ema2_in + ema3_in

// TEMA OUT
ema1_out = ta.ema(close_tf, temaLen_out)
ema2_out = ta.ema(ema1_out, temaLen_out)
ema3_out = ta.ema(ema2_out, temaLen_out)
tema_out = 3 * ema1_out - 3 * ema2_out + ema3_out

// Supertrend IN (ATR dal timeframe corretto)
atr_in = atr10_tf
upC_in = hl2_tf - stFactor_in * atr_in
dnC_in = hl2_tf + stFactor_in * atr_in
var float _up_in = na
var float _dn_in = na
var int trend_in = 0
_up_in := close_tf[1] > nz(_up_in[1], upC_in) ? math.max(upC_in, nz(_up_in[1], upC_in)) : upC_in
_dn_in := close_tf[1] < nz(_dn_in[1], dnC_in) ? math.min(dnC_in, nz(_dn_in[1], dnC_in)) : dnC_in
trend_in := close_tf > _dn_in[1] ? 1 : close_tf < _up_in[1] ? -1 : nz(trend_in[1])

// Supertrend OUT (ATR dal timeframe corretto)
atr_out = atr10_tf
upC_out = hl2_tf - stFactor_out * atr_out
dnC_out = hl2_tf + stFactor_out * atr_out
var float _up_out = na
var float _dn_out = na
var int trend_out = 0
_up_out := close_tf[1] > nz(_up_out[1], upC_out) ? math.max(upC_out, nz(_up_out[1], upC_out)) : upC_out
_dn_out := close_tf[1] < nz(_dn_out[1], dnC_out) ? math.min(dnC_out, nz(_dn_out[1], dnC_out)) : dnC_out
trend_out := close_tf > _dn_out[1] ? 1 : close_tf < _up_out[1] ? -1 : nz(trend_out[1])

// WT IN
ap_in  = hlc3_tf
esa_in = ta.ema(ap_in, wtN1_in)
d_in   = ta.ema(math.abs(ap_in - esa_in), wtN1_in)
ci_in  = (ap_in - esa_in) / (0.015 * d_in)
wt1_in = ta.ema(ci_in, wtN2_in)
wt2_in = ta.sma(wt1_in, 4)
wtUp   = wt1_in > wt2_in

// WT OUT
ap_out  = hlc3_tf
esa_out = ta.ema(ap_out, wtN1_out)
d_out   = ta.ema(math.abs(ap_out - esa_out), wtN1_out)
ci_out  = (ap_out - esa_out) / (0.015 * d_out)
wt1_out = ta.ema(ci_out, wtN2_out)
wt2_out = ta.sma(wt1_out, 4)
wtDown  = ta.crossunder(wt1_out, wt2_out)

distATR = (close_tf - tema_in) / atr_in

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NUOVI INDICATORI - FILTRI AVANZATI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// RSI Filter
rsi = ta.rsi(close_tf, rsiLen)
rsiOK = rsi < rsiOverbought

// Volume Filter
volMA = ta.sma(vol_tf, volMaLen)
volumeOK = vol_tf > volMA * volMultiplier

// ADX - Trend Strength (Anti-Choppy Filter)
[diPlus, diMinus, adx] = ta.dmi(adxLen, adxLen)
trendStrong = adx > adxThreshold

// Volatility Regime (ATR dal timeframe corretto)
atrCurrent = atr14_tf
atrMA = ta.sma(atrCurrent, atrMaLen)
volRegime = atrCurrent / atrMA
isHighVol = volRegime > highVolMultiplier
isNormalVol = volRegime <= highVolMultiplier and volRegime >= lowVolThreshold
isLowVol = volRegime < lowVolThreshold

// Gap Detection (dati multi-timeframe per coerenza)
gap = math.abs(open_tf - close_tf[1])
gapSize = gap / close_tf[1]
hasGap = gapSize > gapThreshold

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENTRY FILTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

tema_slope = tema_in - tema_in[1]
tema_slope_ratio = math.abs(tema_slope) / atr10_tf
isFlatSlope = tema_slope_ratio < 0.008

rangeHigh5 = ta.highest(high_tf, 5)
rangeLow5  = ta.lowest(low_tf, 5)
rangeCond  = (rangeHigh5 - rangeLow5) / close_tf < 0.01
isLateral  = isFlatSlope or rangeCond

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONDIZIONI ENTRY COMPLETE - Sistema Intelligente
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Condizioni base (originali) - SEMPRE RICHIESTE
baseConditions = (trend_in == 1) and wtUp and (distATR <= maxDistATR) and not isLateral

// Sistema di Scoring dei Filtri Avanzati (solo filtri abilitati contano)
rsiFilterPass    = enableRSI ? (rsiOK ? 1 : 0) : 0
volumeFilterPass = enableVolume ? (volumeOK ? 1 : 0) : 0
adxFilterPass    = enableADX ? (trendStrong ? 1 : 0) : 0
gapFilterPass    = enableGapFilter ? (not hasGap ? 1 : 0) : 0

// Calcolo filtri attivi e passati
activeFiltersCount = (enableRSI ? 1 : 0) + (enableVolume ? 1 : 0) + (enableADX ? 1 : 0) + (enableGapFilter ? 1 : 0)
passedFiltersCount = rsiFilterPass + volumeFilterPass + adxFilterPass + gapFilterPass

// Logica intelligente: minimo richiesto limitato ai filtri attivi
effectiveMinRequired = math.min(minFiltersRequired, activeFiltersCount)
filtersOK = not useAdvancedFilters or (activeFiltersCount == 0) or (passedFiltersCount >= effectiveMinRequired)

// Condizione entry finale
longOK = baseConditions and filtersOK
inLong = strategy.position_size > 0

// Entry
if not inLong and longOK
    strategy.entry("Long", strategy.long, comment="LONG")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POSITION MANAGEMENT - Sistema Intelligente con Trailing Stop
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var float entryPrice = na
var int entryBar = na
var bool trailingActivated = false

if inLong and not inLong[1]
    entryPrice := strategy.position_avg_price
    entryBar := bar_index
    trailingActivated := false

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Calcolo Stop Loss
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stopLossPrice = useFixedStopLoss ? entryPrice * (1 - fixedStopPerc - slippagePerc) :
                 useATRStopLoss ? entryPrice - (atr_in * atrStopMultiplier) :
                 entryPrice * (1 - fixedStopPerc - slippagePerc)  // default

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Calcolo Take Profit - 3 LIVELLI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tp1Price = useTakeProfit ? entryPrice * (1 + tp1Perc) : na  // TP1: +2.5%
tp2Price = useTakeProfit ? entryPrice * (1 + tp2Perc) : na  // TP2: +5%
tp3Price = useTakeProfit ? entryPrice * (1 + tp3Perc) : na  // TP3: +8%

// Per compatibilitÃ  con vecchio codice
takeProfitPrice = tp3Price

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Trailing Stop Logic
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
currentProfitPerc = inLong ? (close_tf - entryPrice) / entryPrice : 0.0

if enableTrailing and inLong and currentProfitPerc >= trailingActivationPerc
    trailingActivated := true

// Calcolo trailing stop level
trailingStopPrice = enableTrailing and trailingActivated ?
                     entryPrice * (1 + trailingOffsetPerc) : na

// Stop finale: usa trailing se attivato, altrimenti stop loss normale
finalStopPrice = enableTrailing and trailingActivated ? trailingStopPrice : stopLossPrice

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Exit Conditions (originali)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
exit_wt    = wtDown
exit_st    = trend_out == -1
exit_tema  = close_tf < tema_out
exit_count = (exit_wt ? 1 : 0) + (exit_st ? 1 : 0) + (exit_tema ? 1 : 0)
shouldExit = exit_count >= 3
exit_bar   = inLong and shouldExit

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Gestione Uscite - TAKE PROFIT A 3 LIVELLI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if inLong
    // TP1 - Primo alleggerimento (30% della posizione) + SL protezione
    strategy.exit("TP1", from_entry="Long",
                   stop=finalStopPrice,
                   limit=tp1Price,
                   qty_percent=tp1Qty,
                   comment="TP1 +" + str.tostring(tp1Perc*100, "#.#") + "%")

    // TP2 - Secondo alleggerimento (30% della posizione rimanente) + SL protezione
    strategy.exit("TP2", from_entry="Long",
                   stop=finalStopPrice,
                   limit=tp2Price,
                   qty_percent=tp2Qty,
                   comment="TP2 +" + str.tostring(tp2Perc*100, "#.#") + "%")

    // TP3 + SL - Chiusura finale con stop loss
    strategy.exit("TP3/SL", from_entry="Long",
                   stop=finalStopPrice,
                   limit=tp3Price,
                   comment="TP3/SL")

    // Exit per segnali strategia
    if exit_bar
        strategy.close("Long", comment="Exit Signals")

// Variabili per plot (compatibilitÃ )
stopPrice = finalStopPrice
limitPrice = takeProfitPrice

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLOTS - GRAFICA MIGLIORATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TEMA Lines - Colori piÃ¹ vividi e contrastati
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
temaInColor = color.new(#FF6B00, 0)  // Arancione brillante
temaOutColor = color.new(#00A8FF, 30) // Blu cielo
plot(tema_in, "TEMA IN (Entry)", color=temaInColor, linewidth=3)
plot(tema_out, "TEMA OUT (Exit)", color=temaOutColor, linewidth=2, style=plot.style_line)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Supertrend - Verde/Rosso intensi
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stUpColor = color.new(#00FF41, 0)   // Verde neon
stDnColor = color.new(#FF0055, 0)   // Rosso intenso
plot(trend_in==1 ? _up_in : na, "ST â†‘ Bullish", color=stUpColor, linewidth=3, style=plot.style_linebr)
plot(trend_in==-1 ? _dn_in : na, "ST â†“ Bearish", color=stDnColor, linewidth=3, style=plot.style_linebr)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Background - Zone colorate per volatilitÃ  (opzionale)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
showBgEffective = showBackground and not cleanViewMode
volColor = showBgEffective and isHighVol ? color.new(color.red, 95) : showBgEffective and isLowVol ? color.new(color.yellow, 97) : na
bgcolor(volColor, title="Volatility Regime")
bgcolor(showBgEffective and inLong ? color.new(#00FF41, 95) : na, title="Position Active")
bgcolor(showBgEffective and not trendStrong ? color.new(color.orange, 97) : na, title="Choppy Market Warning")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SL/TP Levels - 3 LIVELLI DI TAKE PROFIT + STOP LOSS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
showLevelsEffective = showLevels and not cleanViewMode

// Colori per i 3 livelli di TP
tp1Color = color.new(#90EE90, 0)   // Verde chiaro
tp2Color = color.new(#32CD32, 0)   // Verde medio
tp3Color = color.new(#00FF41, 0)   // Verde intenso

// Plot linee SL/Entry/TP1/TP2/TP3
slPlot = plot(showLevelsEffective and inLong ? stopPrice : na, "Stop Loss", color=color.new(#FF0055, 0), linewidth=3, style=plot.style_linebr)
entryPlot = plot(showLevelsEffective and inLong ? entryPrice : na, "Entry", color=color.new(#FFFF00, 0), linewidth=2, style=plot.style_linebr)
tp1Plot = plot(showLevelsEffective and inLong ? tp1Price : na, "TP1", color=tp1Color, linewidth=2, style=plot.style_linebr)
tp2Plot = plot(showLevelsEffective and inLong ? tp2Price : na, "TP2", color=tp2Color, linewidth=2, style=plot.style_linebr)
tp3Plot = plot(showLevelsEffective and inLong ? tp3Price : na, "TP3", color=tp3Color, linewidth=3, style=plot.style_linebr)

// Fill zone
fill(entryPlot, slPlot, color=color.new(#FF0055, 92), title="Risk Zone")
fill(entryPlot, tp1Plot, color=color.new(#90EE90, 93), title="TP1 Zone")
fill(tp1Plot, tp2Plot, color=color.new(#32CD32, 93), title="TP2 Zone")
fill(tp2Plot, tp3Plot, color=color.new(#00FF41, 93), title="TP3 Zone")

// Labels con prezzo per SL/TP (solo ultima barra per non sovraccaricare)
if showLevelsEffective and inLong and barstate.islast
    // Stop Loss Label
    slPct = ((stopPrice - entryPrice) / entryPrice) * 100
    label.new(bar_index + 3, stopPrice,
         text="SL: " + str.tostring(stopPrice, "#.#") + " (" + str.tostring(slPct, "#.#") + "%)",
         style=label.style_label_left,
         color=color.new(#FF0055, 20),
         textcolor=color.white,
         size=size.tiny)

    // Entry Label
    label.new(bar_index + 3, entryPrice,
         text="ENTRY: " + str.tostring(entryPrice, "#.#"),
         style=label.style_label_left,
         color=color.new(#FFFF00, 20),
         textcolor=color.black,
         size=size.tiny)

    // TP1 Label
    label.new(bar_index + 3, tp1Price,
         text="TP1: " + str.tostring(tp1Price, "#.#") + " (+" + str.tostring(tp1Perc*100, "#.#") + "%) [" + str.tostring(tp1Qty, "#") + "%]",
         style=label.style_label_left,
         color=color.new(tp1Color, 20),
         textcolor=color.white,
         size=size.tiny)

    // TP2 Label
    label.new(bar_index + 3, tp2Price,
         text="TP2: " + str.tostring(tp2Price, "#.#") + " (+" + str.tostring(tp2Perc*100, "#.#") + "%) [" + str.tostring(tp2Qty, "#") + "%]",
         style=label.style_label_left,
         color=color.new(tp2Color, 20),
         textcolor=color.white,
         size=size.tiny)

    // TP3 Label
    label.new(bar_index + 3, tp3Price,
         text="TP3: " + str.tostring(tp3Price, "#.#") + " (+" + str.tostring(tp3Perc*100, "#.#") + "%) [REST]",
         style=label.style_label_left,
         color=color.new(tp3Color, 20),
         textcolor=color.white,
         size=size.tiny)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Entry/Exit Signals - Dimensione ridotta per leggibilitÃ 
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// In Clean View Mode nascondi i triangoli
showSignals = not cleanViewMode
plotshape(showSignals and longOK and not inLong, "LONG ENTRY", shape.triangleup, location.belowbar, color.new(#00FF41, 0), size=size.small)
plotshape(showSignals and exit_bar, "EXIT", shape.triangledown, location.abovebar, color.new(#FF0055, 0), size=size.small)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Warning Signals - Opzionali (default OFF per grafico pulito)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
showWarningsEffective = showWarnings and not cleanViewMode
plotchar(showWarningsEffective and hasGap and barstate.isconfirmed, "GAP", "G", location.top, color.new(color.orange, 0), size=size.tiny)
plotchar(showWarningsEffective and not rsiOK and barstate.isconfirmed, "RSI High", "R", location.top, color.new(color.red, 0), size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LABELS - Versione migliorata per leggibilitÃ 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Funzione helper per dimensione label
getLabelSize(_size) =>
    switch _size
        "tiny" => size.tiny
        "small" => size.small
        "normal" => size.normal
        "large" => size.large
        => size.small

labelDisplaySize = getLabelSize(labelSize)

// Offset per allontanare i label dalle candele (basato su ATR)
labelOffset = atr14_tf * 4.0

// Clean View Mode disabilita i label
showLabelsEffective = showLabels and not cleanViewMode

if showLabelsEffective
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Entry Label - Versione compatta o completa
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if longOK and not inLong
        labelText = ""

        if compactLabels
            // VERSIONE COMPATTA - Solo info essenziali (mostra TP1/TP2/TP3)
            labelText := "LONG " + str.tostring(close_tf, "#.##") + "\n" +
                 "TP:" + str.tostring(tp1Perc*100, "#") + "/" + str.tostring(tp2Perc*100, "#") + "/" + str.tostring(tp3Perc*100, "#") + "% SL:-" + str.tostring(fixedStopPerc*100, "#") + "%"
        else
            // VERSIONE COMPLETA - Tutte le info
            volRegimeLabel = isHighVol ? "HIGH VOL" : isNormalVol ? "NORMAL" : "LOW"
            filtersInfo = useAdvancedFilters ? str.tostring(passedFiltersCount) + "/" + str.tostring(minFiltersRequired) : "OFF"
            slInfo = useFixedStopLoss ? str.tostring(fixedStopPerc*100, "#.#") + "%" :
                     useATRStopLoss ? str.tostring(atrStopMultiplier, "#.#") + "ATR" : "N/A"
            tpInfo = useTakeProfit ? str.tostring(tp1Perc*100, "#") + "/" + str.tostring(tp2Perc*100, "#") + "/" + str.tostring(tp3Perc*100, "#") + "%" : "-"
            trailingInfo = enableTrailing ? "@" + str.tostring(trailingActivationPerc*100, "#.#") + "%" : "-"

            labelText := "LONG ENTRY\n" +
                 str.tostring(close_tf, "#.##") + "\n" +
                 "SL:" + slInfo + " TP:" + tpInfo + "\n" +
                 "Trail:" + trailingInfo + " F:" + filtersInfo

        label.new(bar_index, low_tf - labelOffset,
             text=labelText,
             style=label.style_label_up,
             color=color.new(#00FF41, 20),
             textcolor=color.white,
             size=compactLabels ? size.small : labelDisplaySize)

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Exit Label - Versione compatta o completa
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if exit_bar
        profitPct = ((close_tf - entryPrice) / entryPrice) * 100
        profitColor = profitPct > 0 ? color.new(#00FF41, 20) : color.new(#FF0055, 20)
        barsHeld = bar_index - entryBar

        labelText = ""

        if compactLabels
            // VERSIONE COMPATTA
            profitSign = profitPct >= 0 ? "+" : ""
            labelText := "EXIT " + profitSign + str.tostring(profitPct, "#.#") + "%"
        else
            // VERSIONE COMPLETA
            exitReason = ""
            if exit_wt
                exitReason := exitReason + "WT "
            if exit_st
                exitReason := exitReason + "ST "
            if exit_tema
                exitReason := exitReason + "TEMA"

            labelText := "EXIT\n" +
                 str.tostring(close_tf, "#.##") + "\n" +
                 "P&L: " + str.tostring(profitPct, "#.##") + "%\n" +
                 "Bars:" + str.tostring(barsHeld) + " " + exitReason

        label.new(bar_index, high_tf + labelOffset,
             text=labelText,
             style=label.style_label_down,
             color=profitColor,
             textcolor=color.white,
             size=compactLabels ? size.small : labelDisplaySize)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD MIGLIORATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table dashboard = table.new(position.top_left, 2, 18, border_width=1, border_color=color.new(#0066FF, 50), frame_width=2, frame_color=color.new(#0066FF, 0))

// Dashboard rispetta Clean View Mode
showDashboardEffective = showDashboard and not cleanViewMode

if showDashboardEffective and barstate.islast
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Header
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    table.cell(dashboard, 0, 0, "TEMA-ST-WT LONG", text_color=color.white, bgcolor=color.new(#0066FF, 0), text_size=size.large)
    table.cell(dashboard, 1, 0, inLong ? "ğŸŸ¢ IN TRADE" : "âšª WAITING", text_color=color.white, bgcolor=inLong ? color.new(#00FF41, 20) : color.new(color.gray, 30), text_size=size.large)

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Position Info
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if inLong
        currentPnL = ((close_tf - entryPrice) / entryPrice) * 100
        bars_in_trade = bar_index - entryBar

        table.cell(dashboard, 0, 1, "Entry Price", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.normal)
        table.cell(dashboard, 1, 1, str.tostring(entryPrice, "#.##"), text_color=color.white, bgcolor=color.new(#2D2D2D, 0), text_size=size.normal)

        table.cell(dashboard, 0, 2, "Current P&L", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.normal)
        pnlColor = currentPnL >= 0 ? color.new(#00FF41, 0) : color.new(#FF0055, 0)
        table.cell(dashboard, 1, 2, str.tostring(currentPnL, "#.##") + "%", text_color=pnlColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.normal)

        table.cell(dashboard, 0, 3, "â›” Stop Loss", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.normal)
        table.cell(dashboard, 1, 3, str.tostring(stopPrice, "#.##"), text_color=color.new(#FF0055, 0), bgcolor=color.new(#2D2D2D, 0), text_size=size.normal)

        table.cell(dashboard, 0, 4, "ğŸ¯ Take Profit", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.normal)
        table.cell(dashboard, 1, 4, str.tostring(limitPrice, "#.##"), text_color=color.new(#00FF41, 0), bgcolor=color.new(#2D2D2D, 0), text_size=size.normal)

        table.cell(dashboard, 0, 5, "Bars in Trade", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.normal)
        table.cell(dashboard, 1, 5, str.tostring(bars_in_trade), text_color=color.white, bgcolor=color.new(#2D2D2D, 0), text_size=size.normal)

        // Trailing Stop Status
        trailingStatus = trailingActivated ? "ğŸ”¥ ACTIVE" : currentProfitPerc >= trailingActivationPerc * 0.8 ? "âš¡ NEAR" : "âšª OFF"
        trailingStatusColor = trailingActivated ? color.new(#00FF41, 0) : currentProfitPerc >= trailingActivationPerc * 0.8 ? color.new(color.orange, 0) : color.new(color.gray, 0)
        table.cell(dashboard, 0, 6, "ğŸ›¡ï¸ Trailing Stop", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.normal)
        table.cell(dashboard, 1, 6, trailingStatus, text_color=trailingStatusColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.normal)

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Entry Filters Status - Sistema Intelligente
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if showFilters
        filtersStatus = useAdvancedFilters ? str.tostring(passedFiltersCount) + "/" + str.tostring(minFiltersRequired) + " REQ" : "DISABLED"
        filtersStatusColor = not useAdvancedFilters ? color.new(color.gray, 30) : passedFiltersCount >= minFiltersRequired ? color.new(#00FF41, 30) : color.new(#FF0055, 30)

        table.cell(dashboard, 0, 7, "ğŸ” FILTERS SCORE", text_color=color.white, bgcolor=color.new(#FF6B00, 20), text_size=size.normal)
        table.cell(dashboard, 1, 7, filtersStatus, text_color=color.white, bgcolor=filtersStatusColor, text_size=size.normal)

        // RSI Filter
        rsiLabel = enableRSI ? "  RSI < " + str.tostring(rsiOverbought) : "  RSI (OFF)"
        rsiValue = enableRSI ? (rsiOK ? "âœ“ " + str.tostring(rsi, "#.#") : "âœ— " + str.tostring(rsi, "#.#")) : "-"
        rsiColor = enableRSI ? (rsiOK ? color.new(#00FF41, 0) : color.new(#FF0055, 0)) : color.new(color.gray, 0)
        table.cell(dashboard, 0, 8, rsiLabel, text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
        table.cell(dashboard, 1, 8, rsiValue, text_color=rsiColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

        // Volume Filter
        volLabel = enableVolume ? "  Vol > MA*" + str.tostring(volMultiplier, "#.#") : "  Volume (OFF)"
        volValue = enableVolume ? (volumeOK ? "âœ“" : "âœ—") : "-"
        volColor = enableVolume ? (volumeOK ? color.new(#00FF41, 0) : color.new(#FF0055, 0)) : color.new(color.gray, 0)
        table.cell(dashboard, 0, 9, volLabel, text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
        table.cell(dashboard, 1, 9, volValue, text_color=volColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

        // ADX Filter
        adxLabel = enableADX ? "  ADX > " + str.tostring(adxThreshold, "#") : "  ADX (OFF)"
        adxValue = enableADX ? (trendStrong ? "âœ“ " + str.tostring(adx, "#.#") : "âœ— " + str.tostring(adx, "#.#")) : "-"
        adxColor = enableADX ? (trendStrong ? color.new(#00FF41, 0) : color.new(#FF0055, 0)) : color.new(color.gray, 0)
        table.cell(dashboard, 0, 10, adxLabel, text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
        table.cell(dashboard, 1, 10, adxValue, text_color=adxColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

        // Gap Filter
        gapLabel = enableGapFilter ? "  No Gap >" + str.tostring(gapThreshold*100, "#.#") + "%" : "  Gap (OFF)"
        gapValue = enableGapFilter ? (not hasGap ? "âœ“" : "âœ—") : "-"
        gapColor = enableGapFilter ? (not hasGap ? color.new(#00FF41, 0) : color.new(#FF0055, 0)) : color.new(color.gray, 0)
        table.cell(dashboard, 0, 11, gapLabel, text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
        table.cell(dashboard, 1, 11, gapValue, text_color=gapColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

        // Volatility Regime
        volRegimeText = isHighVol ? "HIGH âš ï¸" : isLowVol ? "LOW" : "NORMAL"
        volRegimeColor = isHighVol ? color.new(#FF0055, 0) : isLowVol ? color.new(#FFD700, 0) : color.new(#00FF41, 0)
        table.cell(dashboard, 0, 12, "  Volatility", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
        table.cell(dashboard, 1, 12, volRegimeText, text_color=volRegimeColor, bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Exit Conditions
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    table.cell(dashboard, 0, 13, "ğŸšª EXIT CONDITIONS", text_color=color.white, bgcolor=color.new(#FF6B00, 20), text_size=size.normal)
    table.cell(dashboard, 1, 13, str.tostring(exit_count) + " / 3", text_color=color.white, bgcolor=exit_count >= 3 ? color.new(#FF0055, 30) : color.new(#2D2D2D, 0), text_size=size.normal)

    table.cell(dashboard, 0, 14, "  Wave Trend", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
    table.cell(dashboard, 1, 14, exit_wt ? "âœ—" : "âœ“", text_color=exit_wt ? color.new(#FF0055, 0) : color.new(#00FF41, 0), bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

    table.cell(dashboard, 0, 15, "  Supertrend", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
    table.cell(dashboard, 1, 15, exit_st ? "âœ—" : "âœ“", text_color=exit_st ? color.new(#FF0055, 0) : color.new(#00FF41, 0), bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

    table.cell(dashboard, 0, 16, "  TEMA", text_color=color.white, bgcolor=color.new(#1E1E1E, 0), text_size=size.small)
    table.cell(dashboard, 1, 16, exit_tema ? "âœ—" : "âœ“", text_color=exit_tema ? color.new(#FF0055, 0) : color.new(#00FF41, 0), bgcolor=color.new(#2D2D2D, 0), text_size=size.small)

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Footer - Session Info
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    table.cell(dashboard, 0, 17, "Timeframe", text_color=color.white, bgcolor=color.new(#0066FF, 30), text_size=size.tiny)
    table.cell(dashboard, 1, 17, tf + " min", text_color=color.white, bgcolor=color.new(#0066FF, 30), text_size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS - Enhanced with filter info
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(longOK and not inLong, "Long Entry", "ğŸš€ LONG ENTRY {{ticker}} @ {{close}} | All filters passed âœ“")
alertcondition(exit_bar, "Exit Signal", "ğŸ›‘ EXIT {{ticker}} @ {{close}} | Multiple exit conditions triggered")
alertcondition(hasGap, "Gap Detected", "âš ï¸ GAP DETECTED on {{ticker}} | Check price action")
alertcondition(not trendStrong and barstate.isconfirmed, "Choppy Market", "âš ï¸ CHOPPY MARKET {{ticker}} | Low trend strength")
alertcondition(not rsiOK and barstate.isconfirmed, "RSI Overbought", "âš ï¸ RSI OVERBOUGHT {{ticker}} | Avoid entries")
